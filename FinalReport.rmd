---
title: "Covid91 vaccine study Final2021"
author: "Alejandra Sandoval"
date: "Spring 2021"
output: 
  html_document:
    number_sections: true
    toc: true

---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="covid91.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups consisting of Males, Females, just the drug users, and just those in the LGBTQ community. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

# Methods

The first step is isolating the subpopulations of Males, Females, Drug Users, and LGBTQ. 
```{r}
Maledata<- filter(FinalData,sex=="guy")
Maledata$sex <- as.factor(Maledata$sex)
Maledata$infected=factor(Maledata$infected)
Maledata$infected<-relevel(Maledata$infected, "OK")
```

# Males

## Bar Chart

```{r}
Males <- Maledata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(Males,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(Males,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This Barchart shows that out of approximately 340 Males who were infected with Covid-19, 57% were given the drug, and 43% were given the placebo.

## Numerical Summary

```{r}
table1 <- xtabs(~treatment + infected, data=Maledata)
rowPerc(table1)
colPerc(table1)
print(table1)
```

The table shows that about 340 males were infected with Covid-19 out of approximately 10,400 males in the study. The table shows that 3.72% of males who receive the drug got Covid, and 2.55% of the males who got the placebo contracted Covid. The table shows, that males that got the vaccine were about 50% more likely to contract Covid-19, thid suggest that the vaccine is not effective for males.

## Inferential  

```{r}
chisq.test(table1)
chisqtestGC(table1)
fisher.test(table1)
```

The Chi Squared table shows that the P-Value of 0.0006181 is so small that it is highly unlikely that the results are by chance.  
$H_0$ the null hypothesis given taking the vaccine there is no difference of whether males can contract Covid-19 or not.  
$H_A$ the alternative hypothesis is that the vaccine in fact does make a difference in whether or not a male contacts Covid-19.  
Therefore we reject the Null Hypothesis.

The odds ratio from the Fisher Exact test is 1.47:1, when taking the odds ratio and computing it into a percent of effectiveness by using the formula O/(1+0)*100 you get 59.5% effectiveness.  
Ultimately the vaccine is 40% effective in the Male population which is absolutely ineffective.

# Females

```{r}
Femaledata<- filter(FinalData,sex=="gal")
Femaledata$sex <- as.factor(Femaledata$sex)
Femaledata$infected=factor(Femaledata$infected)
Femaledata$infected<-relevel(Femaledata$infected, "OK")
levels(Femaledata$infected)
```

## Barchart

```{r}
Females <- Femaledata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(Females,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(Females,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

## Numerical Summaries

```{r}
table2 <- xtabs(~infected + treatment, data=Femaledata)
rowPerc(table2)
colPerc(table2)
print(table2)
```

## Inferential

```{r}
chisq.test(table2)
chisqtestGC(table2)
fisher.test(table2)
```
The vaccine is 67% effective in Females.


# Drug Users

# Method
```{r}
Druggiedata<- filter(FinalData,DrugUser=="yes")
Druggiedata$DrugUser <- as.factor(Druggiedata$DrugUser)
Druggiedata$infected=factor(Druggiedata$infected)
Druggiedata$infected<-relevel(Druggiedata$infected, "OK")
```

## Barchart

```{r}
Druggies <- Druggiedata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(Druggies,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(Druggies,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

## Numerical Summaries

```{r}
table3 <- xtabs(~infected + treatment, data=Druggiedata)
rowPerc(table3)
colPerc(table3)
print(table3)
```

## Inferential

```{r}
chisq.test(table3)
chisqtestGC(table3)
fisher.test(table3)
```

The vaccine is 60% effective in the Druggie population.

# LGBTQ

# Method
```{r}
LGBTQdata<- filter(FinalData,LGBTQ=="gay")
LGBTQdata$DrugUser <- as.factor(LGBTQdata$LGBTQ)
LGBTQdata$infected=factor(LGBTQdata$infected)
LGBTQdata$infected<-relevel(LGBTQdata$infected, "OK")
```

## Barchart

```{r}
LGBTQ <- LGBTQdata %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(LGBTQ,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(LGBTQ,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

## Numerical Summaries

```{r}
table4 <- xtabs(~treatment + infected, data=LGBTQdata)
rowPerc(table4)
colPerc(table4)
print(table4)
```

## Inferential

```{r}
chisq.test(table4)
chisqtestGC(table4)
fisher.test(table4)
```

The vaccine is not effective in the LGBTQ population, it is only 29% effective.

# Discussion & Conclusions


